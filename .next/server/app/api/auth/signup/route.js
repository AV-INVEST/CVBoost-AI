"use strict";(()=>{var e={};e.id=654,e.ids=[654],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},2960:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>k,requestAsyncStorage:()=>R,routeModule:()=>v,serverHooks:()=>y,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{POST:()=>h,dynamic:()=>c,runtime:()=>u});var a=r(9303),n=r(8716),s=r(3131),i=r(7070),p=r(6005);let u="nodejs",c="force-dynamic",l=globalThis,d=l.__rateStore??new Map;function m(e,t,r){let o=Date.now(),a=o-r,n=(d.get(e)??[]).filter(e=>e>a);return n.length>=t?{limited:!0,retryAfter:Math.ceil((r-(o-n[0]))/1e3)}:(n.push(o),d.set(e,n),{limited:!1,retryAfter:0})}function f(){return process.env.EMAIL_FROM||"noreply@cvboost.ai"}function g(e){return Buffer.from(e).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}async function h(e){try{let{email:t}=await e.json(),o=String(t||"").trim().toLowerCase();if(!o)return i.NextResponse.json({ok:!1,error:"Email mancante"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o))return i.NextResponse.json({ok:!1,error:"Email non valida"},{status:400});let a=function(e){let t=t=>e.headers.get(t)??"",r=t("x-forwarded-for");return r?r.split(",")[0].trim():t("x-real-ip")||"127.0.0.1"}(e),n=`ip:${a}`,s=`pair:${a}:${o}`,u=m(s,5,6e5);if(u.limited)return i.NextResponse.json({ok:!1,error:`Troppi tentativi da questa email/IP. Riprova tra ~${u.retryAfter}s.`},{status:429,headers:{"Retry-After":String(u.retryAfter)}});let c=m(n,20,6e5);if(c.limited)return i.NextResponse.json({ok:!1,error:`Troppi tentativi da questo IP. Riprova tra ~${c.retryAfter}s.`},{status:429,headers:{"Retry-After":String(c.retryAfter)}});let l=Date.now()+18e5,d=function(e){let t=process.env.AUTH_SECRET||"dev-secret",r=g(JSON.stringify({alg:"HS256",typ:"JWT"})),o=g(JSON.stringify(e)),a=(0,p.createHmac)("sha256",t).update(`${r}.${o}`).digest("base64url");return`${r}.${o}.${a}`}({email:o,exp:l}),h=`${process.env.APP_URL||"http://localhost:3000"}/api/auth/callback?token=${encodeURIComponent(d)}`;if(process.env.RESEND_API_KEY)try{let{Resend:e}=await r.e(723).then(r.bind(r,2723)),t=new e(process.env.RESEND_API_KEY);return await t.emails.send({from:f(),to:o,subject:"Accedi a CVBoost.ai",html:`<p>Clicca per accedere in modo sicuro:</p>
                 <p><a href="${h}">${h}</a></p>
                 <p>Il link \xe8 monouso e scade tra 30 minuti.</p>`}),i.NextResponse.json({ok:!0,message:"Email inviata."})}catch(e){console.error("Errore Resend:",e)}return console.log("[DEV magic-link]",{to:o,from:f(),link:h}),i.NextResponse.json({ok:!0,message:"Link generato (console).",devLink:h})}catch(e){return i.NextResponse.json({ok:!1,error:e.message||"Signup error"},{status:500})}}l.__rateStore||(l.__rateStore=d);let v=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/signup/route",pathname:"/api/auth/signup",filename:"route",bundlePath:"app/api/auth/signup/route"},resolvedPagePath:"C:\\Users\\viva_\\OneDrive\\Desktop\\cvboost-ai\\src\\app\\api\\auth\\signup\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:R,staticGenerationAsyncStorage:x,serverHooks:y}=v,A="/api/auth/signup/route";function k(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:x})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972],()=>r(2960));module.exports=o})();